# API Gateway + JWT
Домашнее задание API Gateway
![image](https://user-images.githubusercontent.com/60660331/180840737-a3e03752-b02c-46a6-8e76-aad01b8d938f.png)

**Используется схема авторизации с помощью JWT-токенов**
1. Пользователь создает учетную запись (если ее нет) в сервисе авторизации по адресу **/Login/Api/NewLogin** вводя логин и пароль.
2. Пользователь авторизуется в сервисе авторизации по адресу **/Login/Api/Login** передавая созданные логин и пароль. Сервис авторизации возвращает JWT-токен в полезной нагрузке которого помещен идентификатор пользователя. 
3. Клиентское приложение сохраняет выданный JWT-токен и добавляет его в заголовок ко всем
4. Все запросы по работе с профилем пользователя отправляются по адресам **/Users/~** в сервис управления профилями пользователей.
5. Сервис управления профилями валидирует токен. Если токен не валидный, то возвращается ошибка Unauthorized.
6. После валидации токена на основе полезной нагрузки проверяется имеет ли доступ клиент к ресурсу. Если идентификатор пользователя из полезной нагрузки токена не совпадает с идентификатором учетной записи, то возвращается ошибка Unauthorized.

**Инструкция по установке**
1. Поставить NGINX ингресс через helm, если не установлен
```
helm upgrade --install ingress-nginx ingress-nginx --repo https://kubernetes.github.io/ingress-nginx --namespace ingress-nginx --create-namespace --set controller.admissionWebhooks.enabled=false
```
2. Развернуть сервисы через helm
```
helm install openapi ./helm-chart
```
3. Протестировать работоспособность с помощью newman:
```
newman run ApiGateway.postman_collection.json
```
4. Удаление сервисов
```
helm uninstall openapi
```
